---
/**
 * ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒšãƒ¼ã‚¸
 * 
 * ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«å±ã™ã‚‹ã‚»ãƒªãƒ•ã‚’ä¸€è¦§è¡¨ç¤º
 */
import MainLayout from '../../layouts/MainLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import SearchBar from '../../components/SearchBar.astro';
import SortMenu from '../../components/SortMenu.astro';
import categoriesData from '../../data/categories.json';
import type { Serifu, Category, CategoriesData } from '../../types';

/**
 * é™çš„ãƒ‘ã‚¹ã‚’ç”Ÿæˆï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ã«å…¨ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆï¼‰
 */
export function getStaticPaths() {
  const data = categoriesData as CategoriesData;

  return data.categories.map((category: Category) => ({
    params: { slug: category.id },
    props: { category },
  }));
}

const { category } = Astro.props;

// ã‚»ãƒªãƒ•ã«ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ±ã‚’è¿½åŠ 
const serifuWithCategory = category.serifu.map((serifu: Serifu) => ({
  ...serifu,
  category: category.id,
}));

const title = `${category.name} | ã“ã¨ã°ç®±`;
const description = category.description;
---

<MainLayout title={title} description={description}>
  <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
  <Breadcrumb 
    items={[
      { label: 'ãƒ›ãƒ¼ãƒ ', href: '/kotobako', icon: 'ğŸ ' },
      { label: category.name, icon: category.icon }
    ]} 
  />

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ± -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold mb-3 text-gray-800">
      {category.icon} {category.name}
    </h1>
    <p class="text-lg text-gray-600 mb-2">
      {category.description}
    </p>
    <p class="text-sm text-gray-400">
      å…¨ {category.serifu.length} ä»¶
    </p>
  </div>

  <!-- æ¤œç´¢ãƒãƒ¼ & ã‚½ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <div class="flex-1">
      <SearchBar placeholder={`${category.name}ã®ã‚»ãƒªãƒ•ã‚’æ¤œç´¢...`} />
    </div>
    <SortMenu showFavoriteSort={false} />
  </div>

  <!-- ã‚»ãƒªãƒ•ã‚°ãƒªãƒƒãƒ‰ -->
  <div id="serifu-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- JavaScriptã§å‹•çš„ã«æç”» -->
  </div>
</MainLayout>

<script>
  /**
   * ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–
   */
  import { initializeCategoryPage } from '../../scripts/serifuCard';
  import type { Serifu } from '../../types';
  
  // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ¸¡ã•ã‚ŒãŸã‚»ãƒªãƒ•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const serifuData = document.getElementById('category-serifu-data');
  if (serifuData) {
    const serifuList = JSON.parse(serifuData.textContent || '[]') as Array<Serifu & { category: string }>;
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
    initializeCategoryPage(serifuList);
  }
</script>

<!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ã‚»ãƒªãƒ•ãƒ‡ãƒ¼ã‚¿ã‚’JSONã§åŸ‹ã‚è¾¼ã¿ï¼ˆJavaScriptã‹ã‚‰å‚ç…§ï¼‰ -->
<script type="application/json" id="category-serifu-data" set:html={JSON.stringify(serifuWithCategory)} />