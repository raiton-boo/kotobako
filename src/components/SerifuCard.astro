---
interface Props {
  id: string;
  text: string;
  category: string;
  featured?: boolean;
  createdAt?: string;
  showCategoryInId?: boolean; // ã™ã¹ã¦ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹
}

const { id, text, category, featured = false, createdAt, showCategoryInId = false } = Astro.props;

// ã™ã¹ã¦ãƒšãƒ¼ã‚¸ã®å ´åˆã¯ã‚«ãƒ†ã‚´ãƒªãƒ¼åä»˜ãã§è¡¨ç¤º
let displayId = id.split('-').pop() || id;
if (showCategoryInId) {
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼IDã‚’æ—¥æœ¬èªã«å¤‰æ›
  const categoryNames: Record<string, string> = {
    'batsu-game': 'ç½°ã‚²ãƒ¼ãƒ ',
    'kokuhaku': 'å‘Šç™½',
    'haishin': 'é…ä¿¡',
    'chuunibyou': 'å¨äºŒç—…'
  };
  const categoryName = categoryNames[category] || category;
  displayId = `${categoryName} No.${displayId}`;
} else {
  displayId = `No.${displayId}`;
}

// æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (ä¾‹: "2025-11-07" â†’ "2025/11/07")
const formattedDate = createdAt ? createdAt.replace(/-/g, '/') : '';
---

<div 
  id={`serifu-${id}`}
  class="bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 p-8 relative flex flex-col h-full min-h-[280px] cursor-pointer select-none"
  data-id={id}
  data-category={category}
  data-text={text}
>
  {featured && (
    <span class="absolute top-4 right-4 text-xs px-3 py-1 rounded-full font-bold pointer-events-none" style="background-color: #fbbf24; color: #78350f;">
      â­ ãŠã™ã™ã‚
    </span>
  )}
  
  <div class="flex-1 flex items-center justify-center pointer-events-none">
    <p class="font-serifu text-3xl md:text-4xl text-center leading-relaxed" style="color: #2d3748;">
      {text}
    </p>
  </div>
  
  <div class="flex justify-between items-end mt-6 pt-4 border-t pointer-events-none" style="border-color: #e2e8f0;">
    <div class="flex flex-col gap-1">
      <span class="text-xs font-bold" style="color: #a0aec0;">{displayId}</span>
      {createdAt && (
        <span class="text-xs" style="color: #cbd5e0;">
          Created at {formattedDate}
        </span>
      )}
    </div>
    
    <div class="flex gap-2 pointer-events-auto">
      <button
        class="favorite-btn p-2 rounded-full hover:bg-gray-100 transition-all duration-200"
        aria-label="ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ "
        data-serifu-id={id}
      >
        â¤ï¸
      </button>
      
      <button
        class="copy-btn p-2 rounded-full hover:bg-gray-100 transition-all duration-200"
        aria-label="ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼"
        data-serifu-id={id}
      >
        ğŸ”—
      </button>
    </div>
  </div>

  <!-- é•·æŠ¼ã—ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
  <div class="progress-overlay absolute inset-0 rounded-2xl pointer-events-none opacity-0 transition-opacity duration-200" style="background: linear-gradient(90deg, rgba(167, 139, 250, 0.3) 0%, transparent 0%);">
  </div>
</div>

<style>
  .progress-overlay.active {
    opacity: 1;
  }
</style>