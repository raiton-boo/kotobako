---
interface Props {
  id: string;
  text: string;
  category: string;
  featured?: boolean;
  createdAt?: string;
  showCategoryInId?: boolean;
}

const { id, text, category, featured = false, createdAt, showCategoryInId = false } = Astro.props;

let displayId = id.split('-').pop() || id;
if (showCategoryInId) {
  const categoryNames: Record<string, string> = {
    'batsu-game': 'ç½°ã‚²ãƒ¼ãƒ ',
    'kokuhaku': 'å‘Šç™½',
    'haishin': 'é…ä¿¡',
    'chuunibyou': 'å¨äºŒç—…'
  };
  const categoryName = categoryNames[category] || category;
  displayId = `${categoryName} No.${displayId}`;
} else {
  displayId = `No.${displayId}`;
}

const formattedDate = createdAt ? createdAt.replace(/-/g, '/') : '';
---

<div 
  id={`serifu-${id}`}
  class="bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 p-8 relative transform hover:-translate-y-1 cursor-pointer select-none overflow-hidden"
  data-id={id}
  data-category={category}
  data-text={text}
  style="height: 280px;"
>
  <div class="progress-overlay"></div>

  {featured && (
    <span class="absolute top-4 right-4 bg-yellow-400 text-yellow-900 text-xs px-3 py-1 rounded-full font-bold pointer-events-none" style="z-index: 2;">
      â­ ãŠã™ã™ã‚
    </span>
  )}
  
  <div class="absolute inset-0 flex items-center justify-center p-8" style="padding-bottom: 80px; z-index: 2;">
    <p class="font-serifu text-3xl md:text-4xl text-center leading-relaxed text-gray-800 select-text cursor-text pointer-events-auto">
      {text}
    </p>
  </div>
  
  <div class="absolute bottom-0 left-0 right-0 flex justify-between items-center p-8 pt-4 border-t border-gray-200 pointer-events-none" style="z-index: 2;">
    <div class="flex flex-col gap-1">
      <span class="text-sm font-bold text-gray-400">
        {displayId}
      </span>
      {createdAt && (
        <span class="text-xs text-gray-400">
          Created at {formattedDate}
        </span>
      )}
    </div>
    
    <div class="flex gap-2 pointer-events-auto">
      <button
        class="favorite-btn p-2 rounded-full hover:bg-gray-100 transition-all duration-200"
        aria-label="ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ "
        data-serifu-id={id}
      >
        â¤ï¸
      </button>
      
      <button
        class="copy-btn p-2 rounded-full hover:bg-gray-100 transition-all duration-200"
        aria-label="ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼"
        data-serifu-id={id}
      >
        ğŸ”—
      </button>
    </div>
  </div>
</div>

<style>
  .progress-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, rgba(167, 139, 250, 0.3) 0%, transparent 0%);
    border-radius: 1rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 1;
  }

  .progress-overlay.active {
    opacity: 1;
  }
</style>